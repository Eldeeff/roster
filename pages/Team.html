<div class="mdl-grid">


  <div class="mdl-cell mdl-cell--12-col">
    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" id="add-card">
      <i class="material-icons">add</i> Add team member
    </button>
    <button class="mdl-button mdl-js-button mdl-js-ripple-effect" id="reorder" hidden>
      <i class="material-icons">shuffle</i> Re-order
    </button>
  </div>
  <div class="mdl-cell mdl-cell--12-col" id="team-cards">
  </div>
</div>
<script>
  $(document).ready(function () {
    // load team
    $(r.settings.Team.members).each(function (i, o) {
      $('#team-cards').append($(r.ui.teamMemberCard(o.id, o.name, o.title, o.bg, o.text)));
    });

    if (r.settings.Team.members.length > 1) {
      $('button#reorder').removeProp('hidden');
    }

    // add team member
    $('#Team #add-card').click(function () {
      setTimeout(function () {
        $('#team-cards').append(r.ui.newTeamMemberCard());
      }, 1)
    });

    // edit team member
    $('#team-cards .mdl-card button.edit').on('click', function (e) {
      $('.adding').remove();
      var cardParent = $(this).parents('.mdl-card');
      var clickedID = cardParent.attr('id');

      setTimeout(function () {
        cardParent.hide();
        cardParent.after(r.ui.editTeamMember(clickedID));
      }, 1)
    })

    // remove team member
    $('#team-cards .mdl-card button.remove').on('mousedown', function (e) {
      $('.adding').remove();
      setTimeout(function () {
        var confirmRemove = confirm('Are you sure you want to remove ' + $(e.target).closest('.mdl-card').find('.card-name').text() + '?');
        if (confirmRemove) {
          r.helper.remove($('#team-cards .mdl-card').index($(e.target).closest('.mdl-card')), r.settings.Team.members);
          $('#team-cards .mdl-card button.remove')[0].click();
        };
      }, 1)
    })

    // handler for click outside adding team member card
    $('body').on('click', function (e) {
      if ($('.team-member.adding.mdl-card').length) {
        if ($('#Team #add-card').is(':disabled') && ($(e.target).closest('.adding').length + $(e.target).closest('#Team #add-card:not(:disabled) *').length) !== 1) {
          $('#Team #add-card').prop('disabled', false);
          $('#Team #reorder').prop('disabled', false);
          $('.adding').remove();
          $('.mdl-card').show();
        }
      }
    })

    // sortable 
    setTimeout(function () {
      Sortable.create($('#team-cards')[0], {
        animation: 150, //ms, animation speed moving items when sorting, `0` â€” without animation 
        handle: '.handle', //Restricts sort start click/touch to the specified element 
        draggable: '.team-member',
        group: "team",
        onSort: function(e){
          $('#team-cards .team-member').each(function(){
            $(this).attr('data-id',$(this).index()+1)
          })
          $('button#reorder').addClass('save-data');
        }
      });
    }, 1)

    $('button#reorder').click(function () {
      if (this.textContent.trim() === 'shuffle Re-order') {
        this.childNodes[2].textContent = ' Save order';
        $('#Team #add-card').prop('disabled', true);
        $('#team-cards .team-member').addClass('handle');
      } else {
        this.childNodes[2].textContent = ' Re-order';
        $('#Team #add-card').prop('disabled', false);
        $('#team-cards .team-member').removeClass('handle');
      }
    })
  });
</script>