<section>
  <div class="mdc-card mdc-theme--primary page-buttons">
    <div class="mdc-card__actions">
      <div class="mdc-card__action-buttons">
        <button class="mdc-button mdc-button--unelevated mdc-card__action-button" id="add-card">
          <i class="material-icons mdc-button__icon">account-plus</i> Add team member
        </button>
      </div>
    </div>
  </div>
</section>
<section id="team-cards">
</section>
<script>
  $(document).ready(function () {
    // load team
    $(r.settings.Team.members).each(function (i, o) {
      var dialogClone = $('body > .mdc-dialog').clone().removeProp('hidden');
      $('.mdc-dialog__body', dialogClone).text(`Are you sure you want to remove ${o.name}?`);
      $('#team-cards').append($(r.ui.teamMemberCard(o.id, o.name, o.title, o.bg, o.text).append(dialogClone)));
      if (i < 1) {
        $('#team-cards .handle').hide();
      } else {
        $('#team-cards .handle:hidden').show();
      }
    });

    // add team member
    $('#Team #add-card').on('click', function () {
      var newCard = r.ui.newTeamMemberCard();
      $('#team-cards').append(newCard);
      r.helper.setPalette($(newCard).find('button.colour'));
    });

    // close adding card
    function closeAdding() {
      var adding = $('.adding.open');
      if (adding.length > 0) {
        adding.removeClass('open');
        setTimeout(function () {
          adding.prev('.mdc-card.editing').removeClass('editing');
          adding.remove();
        }, 250);
      }
    }

    // edit team member
    $('#team-cards .mdc-card button.edit').on('click', function (e) {
      closeAdding();

      var cardParent = $(this).parents('.mdc-card');
      var clickedID = cardParent.attr('id');

      cardParent.addClass('editing');
      cardParent.after(r.ui.editTeamMember(clickedID));
    })

    // remove team member
    $('#team-cards .mdc-card button.remove').on('click', function (e) {
      closeAdding();

      var dialog = new mdc.dialog.MDCDialog($('.mdc-dialog', $(e.target).closest('.mdc-card'))[0]);
      dialog.show();

      dialog.listen('MDCDialog:accept', function () {
        r.helper.remove($('#team-cards .mdc-card').index($(e.target).closest('.mdc-card')), r.settings.Team.members);
        $('body').trigger('roster:save');
      });
    })

    // handler for click outside adding team member card
    $('body').on('mousedown', function (e) {
      if ($('.team-member.adding.mdc-card').length > 0) {
        if ($('#Team #add-card:disabled').length + $(e.target).closest('.mdc-card.adding').length == 1) {
          $('#Team #add-card').prop('disabled', false);
          closeAdding();
        }
      }
    })

    // sortable 
    Sortable.create($('#team-cards')[0], {
      animation: 150, //ms, animation speed moving items when sorting, `0` â€” without animation 
      handle: '.handle', //Restricts sort start click/touch to the specified element 
      draggable: '.team-member',
      group: "team",
      onSort: function (e) {
        $('#team-cards .team-member').each(function () {
          $(this).attr('data-id', $(this).index() + 1);
        });
        $('body').trigger('roster:save');
      }
    });
  });
</script>