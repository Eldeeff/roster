<div class="mdc-grid">

  <div class="mdc-cell mdc-cell--12-col" id="templates-cards">
    <h2>Activate Templates</h2>
    <p>More options to come soon</p>
  </div>

  <div class="mdc-cell mdc-cell--12-col">
    <!--
    <button class="mdc-button mdc-js-button mdc-button--raised mdc-js-ripple-effect mdc-button--primary" disabled id="add-card">
      Add template
    </button>
-->
  </div>
</div>
<script>
  $(document).ready(function () {
    // load templates
    $(r.settings.Templates).each(function (i, o) {
      $('#templates-cards').append($(r.ui.templateCard(o)));
    });

    setTimeout(function () {
      $('.mdc-card.template .is-upgraded').on('change keyup', function () {
        if ($('.mdc-card.template .is-invalid').length === 0 && $('.mdc-card.template [required=true] .is-dirty').length === $('.mdc-card.template [required=true] .mdc-js-textfield').length) {
          $('.template .save-data').prop('disabled', false);
        } else {
          $('.template .save-data').prop('disabled', true);
        }
      });


      $('.mdc-card.template div[data-type="range"] input').on('input keyup mouseup', function () {
        var _value = this.value;
        var papa = $(this).parents('div[data-type="range"]');
        if (_value < papa.data('min') || _value > papa.data('max')) papa.find('.mdc-textfield').removeClass('is-invalid');
        if (_value < papa.data('min')) _value = papa.data('min');
        if (_value > papa.data('max')) _value = papa.data('max');
        papa.find('input').each(function () {
          if ($(this).hasClass('mdc-slider')) {
            this.MaterialSlider.change(_value);
            if (papa.find('.mdc-textfield.is-invalid')) papa.find('.mdc-textfield').removeClass('is-invalid');
          } else {
            this.value = _value;
          }
        })
      });
    }, 0)

    // add templates member
    $('#Templates #add-card').click(function () {
      setTimeout(function () {
        $('#Templates #add-card').prop('disabled', true);

        $('#templates-cards').append($(r.ui.newTemplateCard));

        $('.mdc-card.adding *[data-input]').each(function (i, e) {
          $(e).html(r.ui.input($(e)));
          window.componentHandler.upgradeDom();
        });
      }, 1)
    });
    // remove templates member
    $('#templates-cards .mdc-card button.remove').on('mousedown', function (e) {
      var confirmRemove = confirm('Are you sure you want to remove ' + $(e.target).closest('.mdc-card').find('.card-name').text() + '?');
      if (confirmRemove) {
        r.helper.remove($('#templates-cards .mdc-card').index($(e.target).closest('.mdc-card')), r.settings.Templates);
        $('#templates-cards .mdc-card button.remove')[0].click();
      };
    })

    // handler for click outside adding templates member card
    $('body').on('click', function (e) {
      if (($(e.target).closest('.adding').length + $(e.target).closest('#Templates #add-card:not(:disabled) *').length) !== 1) {
        $('#Templates #add-card').prop('disabled', false);
        $('.adding').remove();
      }
    })
  });
</script>